# Development Dockerfile for Nuxt.js frontend with hot reload

FROM node:20

# Set working directory
WORKDIR /app

# Install dependencies for hot reload and development
RUN apt-get update && apt-get install -y \
    git \
    python3 \
    make \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# Copy package files first for better caching
COPY package*.json ./

# Install all dependencies (including dev dependencies)
# Skip postinstall scripts to avoid oxc-parser native binding issues in Docker
RUN npm ci --ignore-scripts

# Run prepare manually if needed for development
RUN npm run postinstall || echo "Prepare step failed, continuing anyway"

# Copy source code
COPY . .

# Create non-root user for development
RUN groupadd -g 1001 nodejs && \
    useradd -u 1001 -g nodejs -m nuxt && \
    chown -R nuxt:nodejs /app

# Switch to non-root user
USER nuxt

# Expose port
EXPOSE 3000

# Set environment variables for development
ENV NUXT_HOST=0.0.0.0
ENV NUXT_PORT=3000
ENV NODE_ENV=development

# Start development server with hot reload
CMD ["npm", "run", "dev"]